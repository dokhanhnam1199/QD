import numpy as np

def heuristics_v2(distance_matrix, coordinates, demands, capacity):
    """{This algorithm constructs a heuristic matrix based on savings values and a penalty for exceeding capacity after considering each pair of nodes.}"""
    n = len(demands)
    heuristics_matrix = np.zeros_like(distance_matrix)

    # Calculate savings values
    savings_matrix = np.zeros_like(distance_matrix)
    for i in range(1, n):
        for j in range(1, n):
            if i != j:
                savings_matrix[i][j] = distance_matrix[0][i] + distance_matrix[0][j] - distance_matrix[i][j]

    # Construct heuristic matrix
    for i in range(1, n):
        for j in range(1, n):
            if i != j:
                # Base heuristic score from savings
                heuristics_matrix[i][j] = savings_matrix[i][j]

                # Capacity penalty: penalize linking nodes that would exceed capacity
                if demands[i] + demands[j] > capacity:
                    heuristics_matrix[i][j] -= (demands[i] + demands[j] - capacity) * np.mean(distance_matrix)

    return heuristics_matrix
